---
author: murmur wheel
title: Shell Summary
---
# Chapter Summary

## chapter 15 呈现数据

在创建脚本时，理解了 `bash shell` 如何处理输入和输出会给你带来很多方便。你可以改变脚本获取数据以及显示数据的方式，从而在任何环境中定制脚本。脚本的输入/输出都可以从标准输入（`STDIN`）/标准输出（`STDOUT`）重定向到系统中的任意文件。除了 `STDOUT`，你可以通过重定向 `STDERR` 输出来重定向由脚本产生的错误消息。这可以重定向于 `STDERR` 输出关联的文件描述符（即是文件描述符 2）来实现。可以将 `STDERR` 输出和 `STDOUT` 输出到同一个文件中，也可以输出到完全不同的文件中。这样就可以将脚本的正常消息同错误消息分离开。

`bash shell` 允许在任何脚本中创建自己的文件描述符。你可以创建文件描述符 `3-9`，并将它们分配给要用到的任何输出文件中。一旦创建了文件描述符，你就可以利用标准的重定向符号将任意命令的输出重定向到那里。

`bash shell` 也允许将输入重定向到一个文件描述符，这给出了一种将文件数据读入到脚本中的简便途径。你可以用 `lsof` 命令来显示 `shell` 中在用的文件描述符。

`Linux` 系统提供了一个特殊的文件（称为 `/dev/null`）来重定向不需要的输出。`Linux` 系统会删掉任何重定向到 `/dev/null` 文件的东西。你也可以通过将 `/dev/null` 文件的内容重定向到一个文件中来产生空文件。

`mktemp` 命令是 `bash shell` 中一个很方便的特性，可以轻松地创建临时文件和目录。只需要给 `mktemp` 命令指定一个模板，他就能在每次调用时基于该文件模板地格式创建一个唯一地文件。

`tee` 命令便于将输出同时发送给标准输出和日志文件。这样就可以在显示器上显示脚本地消息地同时，又能将他们保存在日志文件中。

## chapter 16 控制脚本

Linux 系统允许利用信号来控制 Shell 脚本。bash shell 接受信号，并将他们传给运行在该 shell 进程中的所有进程。Linux 信号允许轻松地终止一个失控进程或临时暂停一个长时间运行的进程。

可以在脚本中用 trap 语句来捕获信号，并执行特定命令，交互式 shell 会挂起，直到脚本运行完。可以在命名后加一个 `&` 符号来让脚本或命令以后台模式云运行。当你在后台模式运行命令或脚本时，交互式 shell 会返回，允许你继续输入其他命令。任何通过这种方式运行的后台进程仍会绑定包该终端会话。如果退出了终端会话，后台进程也会退出。

可以使用 `nohup` 命令阻止这种情况发生。该命令会拦截任何发给某个命令来停止其运行的信号（比如当你退出终端会话时）。这样就可以让脚本继续在后台运行，即便是你已经退出了终端会话。

当你将进程置入后台是，仍然可以控制它的运行。`jobs` 命令可以查看该 `shell` 会话启动的进程。只要知道后台进程的作业号，就可以用 `kill` 命令想该进程发送 Linux 信号，或者用 `fg` 命令将该进程带回到该 `shell` 会话的前台。你可以用 `Ctrl+Z` 组合键挂起正在运行的前台进程，用 `bg` 命令将其置入后台模式。

`nice` 命令和 `renice` 命令可以调整进程的优先级。通过降低进程的优先级，你可以让给该进程分配更少的 CPU 时间。当运行需要消耗大量的 CPU 时间的长期进程时，这一功能非常方便。

除了控制处于运行状态的进程，你可以安排在另一个时间运行该进程。有几种不同的实现途径。`at` 命令允许你在预设的时间运行脚本。`cron` 程序提供了定期运行脚本的接口。

最后，Linux 提供了脚本文件，可以让你的脚本在用户启动一个新的 `bash shell` 时运行。与此类似，位于每个用户主目录中的启动文件（如 `.bashrc`）提供了一个位置来存放新 `shell` 启动时需要运行的脚本和命令。

## chapter 17 创建函数

`shell` 脚本函数允许你将脚本中多处用到的代码放到一个地方。可以创建一个包含该代码块的函数，然后在脚本中通过函数名来引用这块代码，而不用一次次地重写那段代码。`bash shell` 只要看到函数名，就会自动跳到对应地函数代码块处。

甚至可以创建能返回返回值的函数。这样你的函数就能同脚本进行交互，返回数字和字符串数据。脚本函数可以用函数中最后一条命令的退出码或 `return` 命令来返回数值。`return` 命令可以基于函数的结果，通过编程的方式将函数的退出码设为特定值。

函数也可以用标准的 `echo` 语句来返回值。可以用其他 `shell` 命令一样用反引号来获取输出的数据。这样你就能从函数中返回任意类型的数据了（包括字符串和浮点数）。

可以在函数中使用 `shell` 变量，对其赋值以及从中取值。这样你就能将任何类型的数据从主体脚本程序的脚本函数中传入传出。函数也支持定义只能在函数内部访问的局部变量。局部变量使得用户可以创建自成体系的函数，这样就不会影响到 `shell` 脚本主体中变量或处理过程了。

函数也可以调用包括它自身在内的其他函数。函数的自调行为称为递归。递归函数通常用作为函数终结条件的基准值。函数在调用自身的同时会不停地减少参数值，直到达到基准值。

如果需要在 `shell` 脚本中使用大量函数，可以创建脚本函数库文件。库文件可以用 `source` 命令（或该命令的别名）在任何 `shell` 脚本文件中引用，这也称为 `sourcing`。可以用同样的方法创建在普通 `shell` 命令行上使用的函数。你可以直接在命令行定义函数，或者将他们加到 `.bashrc` 文件中，这样每次启动新的 `shell` 会话时就可以使用这些函数了。这是一种创建实用工具的简单方法，不管 `PATH` 环境变量设置成什么，都可以拿来直接使用。

